# Charcle プロジェクト - ペアプログラミング記録

## セッション概要
- 日付: 2025年5月7日
- 目的: Issue #17 の対応 - 書き戻す文字コードが尊重されない問題の修正
- 作業内容: ソースファイルの文字コードを検出して適切に書き戻す機能の実装
- 時間: 進行中

## 問題の理解

Issue #17 では以下の問題が報告されています：

- watchモードで起動中、destinationのファイルが変更されたときにsourceに書き戻しがおこなわれるが、sourceの文字コードが尊重されない
- destinationからsourceに書き戻す場合にすでにファイルが存在していれば、そのファイルの文字コードを判定し、destinationファイルの文字コードから変換して書き戻す必要がある

## コードの調査

関連するファイルを調査しました：

1. `src/charcle/utils/encoding.py` - エンコーディング検出と変換のユーティリティ
2. `src/charcle/converter.py` - ファイル変換のロジック
3. `src/charcle/watcher.py` - ファイル監視と書き戻し機能

問題は `watcher.py` の `_handle_destination_change` メソッドにあります。現在の実装では、書き戻し時にソースファイルの元のエンコーディングを検出せず、コンバーターの設定に依存しています。

## 実装計画

1. `_handle_destination_change` メソッドを修正して、ソースファイルが存在する場合はそのエンコーディングを検出
2. 検出したエンコーディングを使用して書き戻しを行う
3. テストを追加して機能を検証

## 今後のタスク

- コードの修正
- テストの作成と実行
- PRの作成
